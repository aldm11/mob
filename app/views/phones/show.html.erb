<% if @phone %>
<div class="span12">
	<div class="span2 brands-left-sidebar">
		<%= render :partial => 'shared/brands_sidebar', :locals => {:brands => @brands} %>
	</div>
	
	<div class="span6 phone show">
		<div class="well phone-details">
			<h3><%= @phone.name %></h3>
			<%= hidden_field_tag("phone_id", @phone.id) %>
			<div class = "row-fluid phone-info">
				<div class="pull-left">
					<%= content_tag(:span, "Last offer added on #{@last_offer.date_from.strftime('%m/%d/%Y')}",
					:class => "muted last-phone-offer",
					"data-toggle" => "popover",
					"data-original-title" => @last_offer.provider.name,
					"data-content" => "#{render :partial => "phones/offer_provider", :locals => {:catalogue_item => @last_offer}}") %>
				</div>
				<div class="pull-right">
					<span class="label label-important"><%= [I18n.t("price", :price => @min_price), (I18n.t "price", :price => @max_price)].join(" - ") %></span>
				</div>
			</div>
			<div class="row-fluid">
				<div class="phone-image span4">
					<%= @phone.render_image("80") %>
				</div>
				
				<div class="phone-attributes span7">
					<ul class="nav nav-pills nav-stacked">
						<% @phone.attributes_for_display.each do |attr, value| %>
						<%= render :partial => "phones/phone_attribute_item", :locals => {:label => I18n.t("mongoid.attributes.phone."+attr), :value => value} %>
						<% end %>
					</ul>
				</div>
			</div>			
		</div>
		
		<div class="phone-comments">
			<div class="add-comment">
				<%= render :partial => "comments/new", :locals => {:phone => @phone} %>
			</div>
			<% if @comments.empty? %>
			<div class = "muted no-comments">No comments for this phone</div>
			<% else %>
			<%= render :partial => "comments/comment_count", :locals => {:comment_count => @all_comments.length} %>
			<div class="comments">
				<% @comments.each do |comment| %>
				<%= render :partial => "phones/comment_item", :locals => {:comment => comment} %>
				<% end %>
			</div>
			
			<% if @all_comments.length > 10 %>
			<%= render :partial => "phones/load_more_comments" %>
			<% end %>
			<% end %>
		</div>
	</div>
	
	<div class="span3 phone-right-sidebar">
		<% if @offers.empty? %>
		<div class="muted no-offers">No offers for this phone</div>
		<% else %>
		<div class="pull-left">
			<strong class="text-info offer-count"><%= pluralize(@all_offers.length, "offer") %></strong>
		</div>
		<div class="pull-right">
			<%= link_to "#", :id => "sort_by_date", :class => "btn btn-mini disabled", :title => "Sort by date"  do %>
			<i class="icon-arrow-down"></i> Date
			<% end %>
			
		 	<%= link_to "#", :id => "sort_by_price", :class => "btn btn-mini", :title => "Sort by price" do %>
			<i class="icon-arrow-up"></i> Price
			<% end %>
		</div>
		
		<div class="offers">
			<% @offers.each do |offer| %>
			<%= render :partial => "phones/offer_item", :locals => {:offer => offer} %>
			<% end %>
		</div>
		
		<% if @all_offers.length > 1 %>
		<%= render :partial => "phones/load_more_offers" %>
		<% end %>
		<% end %>
	</div>
</div>
<% else %>
<div class = "row-fluid well">
	<p class = "text-error">
		Phone does not exists!
		<%= link_to "Go back to home", root_path %>
	</p>
</div>
<% end %>
